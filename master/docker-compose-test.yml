services:
  jenkins:
    image: jenkins-master-offline:1.0
    container_name: jenkins-master-test
    restart: unless-stopped

    # 端口映射
    ports:
      - "8080:8080"      # Web UI端口
      - "50000:50000"    # Agent连接端口

    # 使用命名卷（避免WSL文件系统问题）
    volumes:
      - jenkins_home_test:/var/jenkins_home
      - /etc/localtime:/etc/localtime:ro

    # 环境变量
    environment:
      # JVM参数配置
      - JAVA_OPTS=-Duser.timezone=Asia/Shanghai -Xmx2g -Xms512m

    # 健康检查
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/login"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 90s

    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "2"

# 数据卷定义
volumes:
  jenkins_home_test:
    driver: local
