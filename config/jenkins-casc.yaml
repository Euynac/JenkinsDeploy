# ==========================================
# Jenkins Configuration as Code (JCasC)
# 用于自动化 Jenkins 初始配置
# ==========================================

jenkins:
  systemMessage: "Jenkins Master - 多技术栈CI/CD平台"

  # 执行器配置（Master节点不执行构建任务）
  numExecutors: 0

  # 安全配置
  securityRealm:
    local:
      allowsSignup: false
      users:
        # 默认管理员账号（生产环境请修改密码）
        - id: "admin"
          password: "${JENKINS_ADMIN_PASSWORD:-admin123}"
          name: "Administrator"
          properties:
            - "apiToken"
            - "mailer":
                emailAddress: "admin@example.com"

  # 授权策略
  authorizationStrategy:
    loggedInUsersCanDoAnything:
      allowAnonymousRead: false

  # Agent 协议配置
  agentProtocols:
    - "JNLP4-connect"
    - "Ping"

  # 全局工具配置
  # tools:
  #   maven:
  #     installations:
  #       - name: "Maven-3.8"
  #         properties:
  #           - installSource:
  #               installers:
  #                 - maven:
  #                     id: "3.8.6"
  #   jdk:
  #     installations:
  #       - name: "JDK-11"
  #         properties:
  #           - installSource:
  #               installers:
  #                 - jdkInstaller:
  #                     id: "jdk-11.0.16"

# 凭证配置
credentials:
  system:
    domainCredentials:
      # GitLab 凭证示例
      - credentials:
          - usernamePassword:
              scope: GLOBAL
              id: "gitlab-credentials"
              username: "${GITLAB_USERNAME:-gitlab}"
              password: "${GITLAB_PASSWORD:-changeme}"
              description: "GitLab用户凭证"

          # SSH密钥示例
          # - basicSSHUserPrivateKey:
          #     scope: GLOBAL
          #     id: "ssh-agent-key"
          #     username: "jenkins"
          #     privateKeySource:
          #       directEntry:
          #         privateKey: "${SSH_PRIVATE_KEY}"
          #     description: "Agent节点SSH密钥"

# 全局库配置
unclassified:
  # 位置配置
  location:
    url: "${JENKINS_URL:-http://localhost:8080/}"
    adminAddress: "admin@example.com"

  # GitLab 连接配置
  # gitLabConnectionConfig:
  #   connections:
  #     - name: "GitLab"
  #       url: "http://gitlab.internal.com"
  #       apiTokenId: "gitlab-api-token"
  #       ignoreCertificateErrors: false

  # SonarQube 配置
  # sonarGlobalConfiguration:
  #   installations:
  #     - name: "SonarQube"
  #       serverUrl: "http://sonarqube.internal.com"
  #       serverAuthenticationToken: "${SONAR_TOKEN}"

  # Nexus 配置
  # mavenModuleSet:
  #   localRepository: "default"

# 定时任务配置
jobs:
  # 示例：自动清理旧构建的任务
  - script: >
      folder('维护任务') {
        description('系统维护相关任务')
      }

# 全局环境变量
# globalNodeProperties:
#   - envVars:
#       env:
#         - key: "NEXUS_URL"
#           value: "http://nexus.internal.com"
#         - key: "SONAR_URL"
#           value: "http://sonarqube.internal.com"
